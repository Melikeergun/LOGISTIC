@{
    Layout = "_Layout";
    ViewBag.Title = "Rotalar";
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script defer src="/js/routes.js"></script>

<section class="grid" style="grid-template-columns: 380px 1fr; gap:18px;">
    <div class="card p-3">
        <h3 class="mb-2">Rota Sihirbazı</h3>

        <label class="mt-2">İl</label>
        <select id="il" class="form-select"></select>

        <label class="mt-2">İlçe</label>
        <select id="ilce" class="form-select"></select>
        <small class="muted">İpucu: "<b>Tümü</b>" seçilirse seçili ildeki <b>tüm ilçelerin semtleri</b> yüklenir.</small>

        <button id="btnLoadPlaces" class="btn primary mt-3" disabled>Semtleri Yükle</button>

        <div id="places" class="mt-3"
             style="max-height:240px;overflow:auto;border:1px solid #22324a;border-radius:8px;padding:6px;">
            <small class="muted">Semtleri görmek için il/ilçe seçin.</small>
        </div>

        <hr class="my-3" />

        <label>Rota Adı</label>
        <input id="routeName" class="form-control" placeholder="Örn: Ankara-(Çankaya)-2025-03-26/8 durak" />

        <div class="grid mt-2" style="grid-template-columns: repeat(3, 1fr); gap:8px;">
            <div>
                <label class="muted">Hız (km/s)</label>
                <input id="speed" class="form-control" type="number" step="1" value="35" />
            </div>
            <div>
                <label class="muted">Tüketim (L/100km)</label>
                <input id="cons" class="form-control" type="number" step="0.1" value="8.0" />
            </div>
            <div>
                <label class="muted">Yakıt (TL/L)</label>
                <input id="fuelPrice" class="form-control" type="number" step="0.1" value="43.0" />
            </div>
        </div>

        <div class="mt-3 flex gap-2" style="flex-wrap:wrap">
            <button id="btnOptimize" class="btn primary" disabled>Optimize Et</button>
            <button id="btnSave" class="btn" disabled>Kaydet</button>
            <button id="btnSim" class="btn">Simülasyon</button>
            <button id="btnMyLoc" class="btn ghost">Konumumu Kullan</button>
            <button id="btnClear" class="btn ghost">Temizle</button>
            <button id="btnExport" class="btn ghost">Dışa Aktar</button>
            <label class="btn ghost" style="cursor:pointer;margin-bottom:0">
                İçe Aktar
                <input id="fileImport" type="file" accept="application/json" style="display:none" />
            </label>
        </div>

        <hr class="my-3" />

        <h4 class="mb-1">Seçilen Duraklar</h4>
        <ol id="stopList" class="mt-2" style="max-height:180px; overflow:auto; padding-left:22px"></ol>

        <div id="summary" class="mt-3 muted"></div>
    </div>

    <div class="card p-0" style="overflow:hidden;">
        <div id="map" style="height:72vh;"></div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
      const il = document.getElementById('il');
      const ilce = document.getElementById('ilce');
      const btnLoad = document.getElementById('btnLoadPlaces');
      const toggle = () => btnLoad.disabled = !(il.value && ilce.value);
      il.addEventListener('change', toggle);
      ilce.addEventListener('change', toggle);

      // routes.js optimize/kaydet butonlarını burada enable eder
      window.__routeWizardReady = (ready) => {
        document.getElementById('btnOptimize').disabled = !ready;
        document.getElementById('btnSave').disabled = !ready;
      };
    });
</script>
